<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/components/BookingManager/Search.jsx | it1901-group-11</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-band">components/Band</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/Concerts.jsx~Concerts.html">Concerts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/Reviews.jsx~AddReview.html">AddReview</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/TechnicalRequirements.jsx~TechnicalRequirements.html">TechnicalRequirements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/index.js~Band.html">Band</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Reviews">Reviews</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-bookingboss">components/BookingBoss</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingBoss/Bookings.jsx~Bookings.html">Bookings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingBoss/index.js~BookingBoss.html">BookingBoss</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Booking">Booking</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-bookingmanager">components/BookingManager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/BookingStepper.jsx~VerticalLinearStepper.html">VerticalLinearStepper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/NewBooking.jsx~NewBooking.html">NewBooking</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/Search.jsx~Search.html">Search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/index.js~BookingManager.html">BookingManager</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-login">components/Login</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Login/index.jsx~Login.html">Login</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-manager">components/Manager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Manager/index.js~Manager.html">Manager</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-organizer">components/Organizer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Organizer/index.js~Organizer.html">Organizer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-EventInfo">EventInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ScenesList">ScenesList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-prorganizer">components/PROrganizer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/PROrganizer/index.js~PROrganizer.html">PROrganizer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ScenesList">ScenesList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-servicemanager">components/ServiceManager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ServiceManager/index.js~ServiceManager.html">ServiceManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Scenes">Scenes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-technician">components/Technician</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Technician/index.js~Technician.html">Technician</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Concerts">Concerts</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Icon">Icon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-InfoSnippet">InfoSnippet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Loading">Loading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-NoResult">NoResult</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Rating">Rating</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Review">Review</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-capitalize">capitalize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseDate">parseDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseNumber">parseNumber</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parsePrice">parsePrice</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseTime">parseTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-muiTheme">muiTheme</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-profiles">profiles</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/components/BookingManager/Search.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { Component } from &apos;react&apos;
import MenuItem from &apos;material-ui/MenuItem&apos;
import TextField from &apos;material-ui/TextField&apos;
import {Icon} from &apos;../../utils&apos;
import SelectField from &apos;material-ui/SelectField&apos;
import RaisedButton from &apos;material-ui/RaisedButton&apos;
import {Toolbar, ToolbarGroup, ToolbarTitle} from &apos;material-ui/Toolbar&apos;
import Band from &apos;../Band&apos;
import {Loading, NoResult} from &apos;../../utils&apos;
import Masonry from &apos;react-masonry-css&apos;

export default class Search extends Component{
  constructor(props) {
    super(props)
    const {bands, concerts, events, scenes} = props
    this.state = {
      query: &quot;&quot;,
      genre: null,
      event: null,
      scene: null,
      sortBy: &quot;&quot;,
      isIncrease: false,
      bands,
      concerts,
      events,
      scenes,
      bandsToOutput : bands ? Object.keys(bands) : null
    }


  }

  componentWillReceiveProps({bands, concerts, events, scenes, name}) {
    if (bands &amp;&amp; concerts &amp;&amp; name) {
      this.setState({
        bands,
        bandsToOutput: Object.keys(bands),
        concerts,
        events,
        scenes,
        name
      })
    }
    else this.setState({bandsToOutput: null})
  }

  resetFilters = () =&gt; {
    this.setState({
      query: &quot;&quot;,
      event: null,
      scene: null,
      genre: null
    })
    this.handleFilters(&quot;event&quot;, null)
  }
  handleFilters = (filterBy, value) =&gt; {
    if (filterBy === &quot;event&quot;) {
      this.setState({scene: null})
    }
    this.setState({[filterBy]: value}, () =&gt; {
      const {
        bands, concerts,
        query, event, scene, genre
      } = this.state

      let bandsToOutput = Object.keys(bands)
      bandsToOutput = bandsToOutput
      // Filter by Search query
      .filter(bandKey =&gt; bands[bandKey].name.toLowerCase().includes(query))
      // Filter by genre
      .filter(bandKey =&gt; (genre ? bands[bandKey].genre === genre : bandKey))
      //Filter by event

      .filter(bandKey =&gt; (event ?
        bands[bandKey].concerts.some(concertKey =&gt; concerts[concertKey] &amp;&amp; concerts[concertKey].event === event) : bandKey
      ))
      // Filter by scene
      .filter(bandKey =&gt; (scene ?
        bands[bandKey].concerts.some(concertKey =&gt; concerts[concertKey] &amp;&amp; concerts[concertKey].scene === scene) : bandKey
      ))

      this.setState({bandsToOutput})
    })
  }


  handleSorters = (sortBy, isIncrease) =&gt; {
    let {bands, bandsToOutput} = this.state
    let filtered = bandsToOutput.map(bandKey =&gt; [bandKey, bands[bandKey]])
    filtered.sort((a, b) =&gt; ( isIncrease ?
      a[1][sortBy].toString().localeCompare(b[1][sortBy].toString()):
      b[1][sortBy].toString().localeCompare(a[1][sortBy].toString())
    ))
    bandsToOutput = filtered.map(band =&gt; band[0])
    this.setState({bandsToOutput, isIncrease})
  }

   render(){
    const {
      query,
      isIncrease,
      bands, bandsToOutput,
      events, scenes,
      event, scene, genre,
      name: reviewerName
    } = this.state

    let concerts = {...this.state.concerts}

    if (event) {
      Object.keys(concerts).forEach(concertKey =&gt; {
        const filteredConcert = concerts[concertKey]
        if (filteredConcert.event !== event) {
          delete concerts[concertKey]
        }
        if (scene) {
          if (filteredConcert.scene !== scene) {
            delete concerts[concertKey]
          }
        }
      })
    }

     return(
       &lt;div&gt;
         &lt;Toolbar&gt;
           &lt;div style={{width: &quot;100%&quot;,display: &quot;flex&quot;, alignItems: &quot;center&quot;}}&gt;
             &lt;TextField
               fullWidth
               hintText=&quot;Search for band&quot;
               value={query}
               onChange={({target:{value}}) =&gt; this.handleFilters(&quot;query&quot;, value.toLowerCase())}
             /&gt;
             &lt;Icon name=&quot;search&quot; color=&quot;grey&quot;/&gt;
           &lt;/div&gt;
         &lt;/Toolbar&gt;
         &lt;Toolbar &gt;
           &lt;ToolbarGroup&gt;
             &lt;ToolbarTitle text=&quot;Filter&quot;/&gt;
             &lt;SelectField
               value={event}
               onChange={(event, index, value) =&gt; this.handleFilters(&quot;event&quot;, value)}
             &gt;
               &lt;MenuItem key=&quot;All events&quot; value={null} primaryText=&quot;All events&quot;/&gt;
               {events &amp;&amp; Object.keys(events).map(eventKey =&gt; (
                 &lt;MenuItem
                   key={eventKey}
                   value={eventKey}
                   primaryText={events[eventKey].name}
                 /&gt;
               )
               )}
             &lt;/SelectField&gt;
             &lt;SelectField
               value={scene}
               onChange={(event, index, value) =&gt; this.handleFilters(&quot;scene&quot;, value)}
             &gt;
               &lt;MenuItem key=&quot;All scene&quot; value={null} primaryText=&quot;All scene&quot;/&gt;
               {event &amp;&amp; events[event].scenes.map(sceneKey =&gt; (
                 &lt;MenuItem
                   key={sceneKey}
                   value={sceneKey}
                   primaryText={scenes[sceneKey].name}
                 /&gt;
               ))}
             &lt;/SelectField&gt;
             &lt;SelectField value={genre} onChange={(event, index, value) =&gt; this.handleFilters(&quot;genre&quot;, value)} &gt;
               &lt;MenuItem value={null} primaryText=&quot;All genres&quot; /&gt;
               &lt;MenuItem value={&quot;Pop&quot;} primaryText=&quot;Pop&quot; /&gt;
               &lt;MenuItem value={&quot;Rock&quot;} primaryText=&quot;Rock&quot; /&gt;
               &lt;MenuItem value={&quot;Electric&quot;} primaryText=&quot;Electric&quot; /&gt;
               &lt;MenuItem value={&quot;Rap&quot;} primaryText=&quot;Rap&quot; /&gt;
               &lt;MenuItem value={&quot;RnB&quot;} primaryText=&quot;RnB&quot; /&gt;
             &lt;/SelectField&gt;
           &lt;/ToolbarGroup&gt;
           &lt;ToolbarGroup&gt;
             &lt;RaisedButton label=&quot;Reset filters&quot; onClick={this.resetFilters} primary/&gt;
             {bandsToOutput &amp;&amp; `${bandsToOutput.length} result(s)`}
           &lt;/ToolbarGroup&gt;
         &lt;/Toolbar&gt;
         &lt;Toolbar&gt;
           &lt;ToolbarGroup&gt;
             &lt;ToolbarTitle text=&quot;Sort by&quot;/&gt;
             &lt;div style={{display: &quot;flex&quot;, cursor: &quot;pointer&quot;}} onClick={() =&gt; this.handleSorters(&quot;name&quot;, !isIncrease)}&gt;
               &lt;p&gt;Name&lt;/p&gt;
               &lt;Icon name=&quot;sort_by_alpha&quot;/&gt;
             &lt;/div&gt;
             &lt;div style={{display: &quot;flex&quot;, cursor: &quot;pointer&quot;}} onClick={() =&gt; this.handleSorters(&quot;genre&quot;, !isIncrease)}&gt;
               &lt;p&gt;Genre&lt;/p&gt;
               &lt;Icon name=&quot;sort&quot;/&gt;
             &lt;/div&gt;
           &lt;/ToolbarGroup&gt;
         &lt;/Toolbar&gt;
         &lt;Masonry
           breakpointCols={{
             default: 2,
             960: 1
           }}
           style={{
             margin: &quot;0 auto&quot;,
             paddingLeft: 20,
             display: &quot;flex&quot;,
             width: &quot;100vw&quot;
           }}
           columnClassName=&quot;band-list-column&quot;
         &gt;
           {bandsToOutput ?
             bandsToOutput.map(bandKey =&gt; {
               const band = bands[bandKey]
               const {name, genre} = band
               return(
                 &lt;Band
                   key={bandKey}
                   headerType={&apos;big&apos;}
                   title={name}
                   subtitle={genre}
                   showAlbumSales showMonthlyListeners showGenre showManager
                   showPreviousConcerts showFutureConcerts
                   showRequirements
                   canAddReview
                   {...{bandKey, band, concerts, reviewerName}}
                 /&gt;
               )
             }) :
             &lt;Loading/&gt;
           }
         &lt;/Masonry&gt;
         {bandsToOutput &amp;&amp; !bandsToOutput.length &amp;&amp; &lt;NoResult text={&quot;This is not the search result you are looking for.&quot;}/&gt;}
       &lt;/div&gt;
     )}
 }
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
