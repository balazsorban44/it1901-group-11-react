<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/components/BookingManager/BookingStepper.jsx | it1901-group-11</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-band">components/Band</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/Concerts.jsx~Concerts.html">Concerts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/Reviews.jsx~AddReview.html">AddReview</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/TechnicalRequirements.jsx~TechnicalRequirements.html">TechnicalRequirements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/index.js~Band.html">Band</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Reviews">Reviews</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-bookingboss">components/BookingBoss</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingBoss/Bookings.jsx~Bookings.html">Bookings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingBoss/index.js~BookingBoss.html">BookingBoss</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Booking">Booking</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-bookingmanager">components/BookingManager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/BookingStepper.jsx~VerticalLinearStepper.html">VerticalLinearStepper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/NewBooking.jsx~NewBooking.html">NewBooking</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/Search.jsx~Search.html">Search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/index.js~BookingManager.html">BookingManager</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-login">components/Login</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Login/index.jsx~Login.html">Login</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-manager">components/Manager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Manager/index.js~Manager.html">Manager</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-organizer">components/Organizer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Organizer/index.js~Organizer.html">Organizer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-EventInfo">EventInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ScenesList">ScenesList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-prorganizer">components/PROrganizer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/PROrganizer/index.js~PROrganizer.html">PROrganizer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ScenesList">ScenesList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-servicemanager">components/ServiceManager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ServiceManager/index.js~ServiceManager.html">ServiceManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Scenes">Scenes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-technician">components/Technician</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Technician/index.js~Technician.html">Technician</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Concerts">Concerts</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Icon">Icon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-InfoSnippet">InfoSnippet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Loading">Loading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-NoResult">NoResult</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Rating">Rating</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Review">Review</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-capitalize">capitalize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseDate">parseDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseNumber">parseNumber</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parsePrice">parsePrice</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseTime">parseTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-muiTheme">muiTheme</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-profiles">profiles</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/components/BookingManager/BookingStepper.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, {Component} from &apos;react&apos;
import TextField from &apos;material-ui/TextField&apos;
import RaisedButton from &apos;material-ui/RaisedButton&apos;
import FlatButton from &apos;material-ui/FlatButton&apos;
import AutoComplete from &apos;material-ui/AutoComplete&apos;
import DatePickerDialog from &apos;material-ui/DatePicker/DatePickerDialog&apos;
import TimePickerDialog from &apos;material-ui/TimePicker/TimePickerDialog&apos;
import DateTimePicker from &apos;material-ui-datetimepicker&apos;
import MenuItem from &apos;material-ui/MenuItem&apos;
import SelectField from &apos;material-ui/SelectField&apos;
import {Step, StepLabel, Stepper, StepContent} from &apos;material-ui/Stepper&apos;
import {Icon, parsePrice} from &apos;../../utils&apos;

import Moment from &apos;moment&apos;
import { extendMoment } from &apos;moment-range&apos;
const moment = extendMoment(Moment)

export default class VerticalLinearStepper extends Component {
  constructor() {
    super()
    this.state = {
      stepIndex: 0,
      bandName: &quot;&quot;,
      band: null,
      bandFee: null,
      currentEvent: null,
      event: null,
      scene: null,
      from: Date.now(),
      to: null,
      technician: null,
      stepDisabled: Array(6).fill(true)
    }
  }

  handleStepChange = (stepIndex) =&gt; {
    let {stepDisabled} = this.state
    stepDisabled[stepIndex] = false
    this.setState({stepDisabled})
  }

  handleBandChange = (element, index) =&gt; {
    const {bands, bandNames} = this.props
    Object.keys(bands).forEach(bandKey =&gt; {
      if (bandNames[index] === bands[bandKey].name) {
        this.setState({band: bandKey})
      }
    })
    this.handleStepChange(0)
  }

  handleBandSearchText = bandName =&gt; this.setState({bandName})

  handleBandFeeChange = e =&gt; {
    const bandFee = Number(e.target.value)
    this.setState({bandFee})
    this.handleStepChange(1)
  }

  // If an event is chosen from the dropdown,
  // handleEventChange() will make an eventScenes
  // Object, to narrow down the possible scenes options.
  handleEventChange = (event, index, value) =&gt; {
    this.setState({
      currentEvent: this.props.events[value],
      event: value
    })
    this.handleStepChange(2)
  }

  handleSceneChange = (event, index, value) =&gt; {
    this.setState({scene: value})
    this.handleStepChange(3)
  }

  // Sets the date input as a UNIX timestamp
  // to this.state.from.
  handleStartDateChange = date =&gt; {
    this.setState({from: date.getTime()})
    this.handleStepChange(4)
  }

  limitAcceptedDates = date =&gt; {
    let {from, to} = this.state.currentEvent
    const day = moment(date)
    // Substract one day from &apos;from&apos; to include the first day of the concert
    const eventRange = moment.range(from-(60*60*1000*24), to)
    return !day.within(eventRange)
  }


  handleConcertLengthChange = e =&gt; {
    const hours = Number(e.target.value)*60*60*1000
    const {from} = this.state
    const to = from + hours
    if (from &lt; to) {
      this.setState({to})
      this.handleStepChange(5)
    }
  }


  handleTechnicianChange = (event, index, value) =&gt; {
    this.setState({technician: value})
    this.handleStepChange(6)
  }

  handleNext = () =&gt; {
    const {stepIndex,
      band, bandFee,
      event, from, to,
      scene, technician
    } = this.state
    this.setState({
      stepIndex: stepIndex + 1
    })
    if (stepIndex === 6) {
      this.props.createBooking({
        band, bandFee,
        event,
        from, to,
        scene,
        technicians: {
          [technician]: {
            isAttending: false
          }
        },
        ticketPrice: 0,
        isAcceptedByBookingBoss : &quot;unhandled&quot;,
        isAcceptedByBookingManager : true,
        participants : 0
      })
    }
  }

  handlePrev = () =&gt; {
    const {stepIndex} = this.state
    if (stepIndex &gt; 0) {
      this.setState({stepIndex: stepIndex - 1})
    }
  }

  renderStepActions(step) {
    const {stepIndex, stepDisabled} = this.state
    return (
      &lt;div style={{margin: &apos;12px 0&apos;}}&gt;
        {stepIndex &lt; 7 &amp;&amp;
          &lt;RaisedButton
            label={&apos;Next&apos;}
            disableTouchRipple
            disableFocusRipple
            primary
            disabled={stepDisabled[stepIndex]}
            onClick={this.handleNext}
            style={{marginRight: 12}}
          /&gt;
        }
        {step &gt; 0 &amp;&amp; (
          &lt;FlatButton
            label=&quot;Back&quot;
            disabled={stepIndex === 0}
            disableTouchRipple
            disableFocusRipple
            onClick={this.handlePrev}
          /&gt;
        )}
      &lt;/div&gt;
    )
  }

  render() {
    const {
      stepIndex, stepDisabled,
      bandName, bandFee,
      event, currentEvent,
      scene,
      from,
      technician
    } = this.state
    const {bandNames, events, scenes, technicians} = this.props

    return (
      &lt;div&gt;
        &lt;Stepper activeStep={stepIndex} orientation=&quot;vertical&quot;&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;star&quot;/&gt;}&gt;Select a band {bandName !== &quot;&quot; &amp;&amp; `(${bandName})`}&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;Which band you want to book a concert for?&lt;/p&gt;
              &lt;AutoComplete
                filter={AutoComplete.fuzzyFilter}
                onUpdateInput={this.handleBandSearchText}
                searchText={bandName}
                dataSource={bandNames}
                floatingLabelText=&quot;Band&quot;
                maxSearchResults={7}
                onNewRequest={this.handleBandChange}
              /&gt;
              {this.renderStepActions(0)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;monetization_on&quot;/&gt;}&gt;Set the band fee {bandFee &amp;&amp; `(${parsePrice(bandFee)})`}&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;How much money the band will earn on the concert?&lt;/p&gt;
              &lt;TextField
                hintText=&quot;(NOK)&quot;
                onChange={this.handleBandFeeChange}
                type=&quot;number&quot;
                min={1}
                value={bandFee ? bandFee : &quot;&quot;}
              /&gt;
              {this.renderStepActions(1)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;event&quot;/&gt;}&gt;Select an event {event &amp;&amp; `(${currentEvent.name})`}&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;On which event do you want the band to play?&lt;/p&gt;
              {!stepDisabled[1] &amp;&amp;
                &lt;SelectField
                  value={event}
                  onChange={this.handleEventChange}
                &gt;
                  &lt;MenuItem key={&quot;Event&quot;} value={null} primaryText=&quot;Event&quot;/&gt;
                  {events &amp;&amp; Object.keys(events).map(eventKey =&gt; (
                    &lt;MenuItem
                      key={eventKey}
                      value={eventKey}
                      primaryText={events[eventKey].name}
                    /&gt;))
                  }
                &lt;/SelectField&gt;
              }
              {this.renderStepActions(2)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;account_balance&quot;/&gt;}&gt;Select a scene {scene &amp;&amp; `(${scenes[scene].name})`}&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;On which scene do you want the band to play?&lt;/p&gt;
              {!stepDisabled[2] &amp;&amp;
                &lt;SelectField
                  value={scene}
                  onChange={this.handleSceneChange}&gt;
                  &lt;MenuItem key={&quot;Scene&quot;} value={null} primaryText=&quot;Scene&quot;/&gt;
                  {currentEvent &amp;&amp; currentEvent.scenes.map(key =&gt; (
                    &lt;MenuItem
                      key={key}
                      value={key}
                      primaryText={scenes[key].name}
                    /&gt;))
                  }
                &lt;/SelectField&gt;
              }
              {this.renderStepActions(3)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;date_range&quot;/&gt;}&gt;Set start date&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;Please specify when should the band start.&lt;/p&gt;
              &lt;label htmlFor=&quot;start-date&quot;&gt;Start date: &lt;/label&gt;
              {!stepDisabled[3] &amp;&amp;
                &lt;DateTimePicker
                  DatePicker={DatePickerDialog}
                  TimePicker={TimePickerDialog}
                  id=&quot;start-date&quot;
                  format=&apos;YYYY-MM-DD hh:mm&apos;
                  hintText=&quot;Start date&quot;

                  // REVIEW: Waiting for node module to be updated
                  // https://github.com/dmtrKovalenko/material-ui-datetimepicker/issues/17
                  /* autoOk */

                  defaultTime={new Date(events[event].from)}
                  value={from ? new Date(from) : new Date(events[event].from)}
                  minutesStep={30}
                  onChange={this.handleStartDateChange}
                  shouldDisableDate={this.limitAcceptedDates}/&gt;
              }
              {this.renderStepActions(4)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;timelapse&quot;/&gt;}&gt;Concert length&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;Please specify the length of the concert&lt;/p&gt;
              {!stepDisabled[4] &amp;&amp;
                &lt;TextField
                  id=&quot;concert-length&quot;
                  hintText=&quot;(hours)&quot;
                  type=&quot;number&quot;
                  min={1}
                  onChange={this.handleConcertLengthChange}
                /&gt;
              }
              {this.renderStepActions(5)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;settings_input_component&quot;/&gt;}&gt;Select a technician&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;Please select an audio/light technician who will prepare the scene for the concert.&lt;/p&gt;
              {!stepDisabled[5] &amp;&amp;
                &lt;SelectField
                  value={technician}
                  onChange={this.handleTechnicianChange}&gt;
                  &lt;MenuItem key={0} value={null} primaryText=&quot;Technician&quot;/&gt;
                  {currentEvent.staff.technicians.map(key =&gt; (
                    &lt;MenuItem
                      key={key}
                      value={key}
                      primaryText={technicians[key].name}
                    /&gt;))
                  }
                &lt;/SelectField&gt;
              }
              {this.renderStepActions(6)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
          &lt;Step&gt;
            &lt;StepLabel icon={&lt;Icon name=&quot;done_all&quot;/&gt;}&gt;Almost done...&lt;/StepLabel&gt;
            &lt;StepContent&gt;
              &lt;p&gt;Please send your booking request to the Booking Boss for approval.&lt;/p&gt;
              {this.renderStepActions(7)}
            &lt;/StepContent&gt;
          &lt;/Step&gt;
        &lt;/Stepper&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
