<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/components/Organizer/index.js | it1901-group-11</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-band">components/Band</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/Concerts.jsx~Concerts.html">Concerts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/Reviews.jsx~AddReview.html">AddReview</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/TechnicalRequirements.jsx~TechnicalRequirements.html">TechnicalRequirements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Band/index.js~Band.html">Band</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Reviews">Reviews</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-bookingboss">components/BookingBoss</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingBoss/Bookings.jsx~Bookings.html">Bookings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingBoss/index.js~BookingBoss.html">BookingBoss</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Booking">Booking</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-bookingmanager">components/BookingManager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/BookingStepper.jsx~VerticalLinearStepper.html">VerticalLinearStepper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/NewBooking.jsx~NewBooking.html">NewBooking</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/Search.jsx~Search.html">Search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BookingManager/index.js~BookingManager.html">BookingManager</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-login">components/Login</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Login/index.jsx~Login.html">Login</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-manager">components/Manager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Manager/index.js~Manager.html">Manager</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-organizer">components/Organizer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Organizer/index.js~Organizer.html">Organizer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-EventInfo">EventInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ScenesList">ScenesList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-prorganizer">components/PROrganizer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/PROrganizer/index.js~PROrganizer.html">PROrganizer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ScenesList">ScenesList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-servicemanager">components/ServiceManager</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ServiceManager/index.js~ServiceManager.html">ServiceManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Scenes">Scenes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-technician">components/Technician</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Technician/index.js~Technician.html">Technician</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Concerts">Concerts</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Icon">Icon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-InfoSnippet">InfoSnippet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Loading">Loading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-NoResult">NoResult</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Rating">Rating</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Review">Review</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-capitalize">capitalize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseDate">parseDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseNumber">parseNumber</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parsePrice">parsePrice</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseTime">parseTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-muiTheme">muiTheme</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-profiles">profiles</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/components/Organizer/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { Component } from &apos;react&apos;
import firebase from &apos;firebase&apos;
import MenuItem from &apos;material-ui/MenuItem&apos;
import DropDownMenu from &apos;material-ui/DropDownMenu&apos;
import {Toolbar, ToolbarGroup} from &apos;material-ui/Toolbar&apos;
import {Loading} from &apos;../../utils&apos;
import EventInfo from &apos;./EventInfo&apos;
import Scenes from &apos;./Scenes&apos;

/**
* This is the Organizer Component
*/

export default class Organizer extends Component {

  /**
  * Organizer constructor
  */

  constructor() {
    super()

    /**
    * Contain data that may change over time
    * @type {Object} state
    * @property {Object} state.events
    * @property {number} state.value
    */

    this.state = {
      events: {},
      value: 1
    }
  }

/**
Fetch and Validate data
*/

  componentDidMount() {
    const db = firebase.database().ref()
    const eventsRef = db.child(&apos;events&apos;)
    const scenesRef = db.child(&apos;scenes&apos;)
    const concertsRef = db.child(&apos;concerts&apos;)
    const bandsRef = db.child(&apos;bands&apos;)
    const profilesRef = db.child(&apos;staff/profiles&apos;)

    eventsRef.on(&apos;value&apos;, snap =&gt; {
      const events = snap.val()
      Object.keys(events).forEach(eventKey =&gt; {
        const event = events[eventKey]
        if (event.staff.organizer.includes(this.props.user.uid)) {
            // Fetch event staff information
          const {staff} = event
          Object.keys(staff).forEach(roleKey =&gt; {
            const roleMembers = staff[roleKey]
            staff[roleKey] = []
            roleMembers.forEach(roleMember =&gt; {
              profilesRef.child(`${roleMember}`).on(&apos;value&apos;, snap =&gt; {
                staff[roleKey].push(snap.val())
              })
            })
          })

          // Fetch scenes information
          const {scenes} = event
          event.scenes = {}
          scenes.forEach(sceneKey =&gt; {
            scenesRef.child(sceneKey).on(&apos;value&apos;, snap =&gt; {
              const scene = snap.val()
              event.scenes[sceneKey] = scene
              const {concerts} = scene
              concerts.forEach(concertKey =&gt; {
                delete event.scenes[sceneKey].concerts
                scene.bands = []
                concertsRef.child(concertKey).on(&apos;value&apos;, snap =&gt; {
                  let {band, from, to, technicians} = snap.val()
                  Object.keys(technicians).forEach(technicianKey =&gt; {
                    profilesRef.child(technicianKey).on(&apos;value&apos;, snap =&gt; {
                      technicians[technicianKey].name = snap.val().name
                    })
                  })
                  bandsRef.child(`${band}/name`).on(&apos;value&apos;, snap =&gt; {
                    scene.bands.push({
                      name: snap.val(), from, to,
                      technicians: {
                        ...technicians
                      }})
                    this.setState({events, value: Object.keys(events)[0]})
                  })
                })
              })
            })
          })
        } else {
          delete events[eventKey]
        }
      })
    })
  }

  /**
    * Handle click of event dropdown
    * @param {Object} Clicked element
    * @param {number} Clicked Event&apos;s index
    * @param {String} Clicked Event&apos;s ID
    */

  handleChange = (event, index, value) =&gt; this.setState({value})

  /**
    * Display Organizer
    * @return {JSX} Return Organizer
    */
  render() {
    const {events, value} = this.state
    return (
        &lt;div className=&quot;organizer role&quot;&gt;
          &lt;Toolbar&gt;
            &lt;ToolbarGroup&gt;
              &lt;DropDownMenu value={value} onChange={this.handleChange}&gt;
                {Object.keys(events).map(key =&gt; (
                  &lt;MenuItem
                    key={key}
                    value={key}
                    primaryText={events[key].name}
                  /&gt;))
                }
              &lt;/DropDownMenu&gt;
            &lt;/ToolbarGroup&gt;
          &lt;/Toolbar&gt;
          {
            events[value] ? &lt;EventView event={events[value]}/&gt; : &lt;Loading/&gt;
          }
        &lt;/div&gt;
    )
  }
}


/**
  * Display an event
  * @param {Object} props
  * @param {Object} props.event - Event
  * @return {JSX} Return an event
  */
const EventView = ({event}) =&gt;  {
  const {scenes, staff, from} = event
  return (
    &lt;div className=&quot;event&quot;&gt;
      &lt;EventInfo event={event} staff={staff}/&gt;
      &lt;Scenes eventStart={from} scenes={scenes}/&gt;
    &lt;/div&gt;
  )
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
